--연습용 데이터
WITH emp AS (
    SELECT 7839 EMPNO, 'KING'   ENAME, 'PRESIDENT' JOB, NULL MGR, TO_DATE('1981-11-17', 'YYYY-MM-DD') HIREDATE, 5000 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1981-11-16 09:00:05', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7698 EMPNO, 'BLAKE'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-05-01', 'YYYY-MM-DD') HIREDATE, 2850 SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-04-30 10:30:20', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7782 EMPNO, 'CLARK'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-06-09', 'YYYY-MM-DD') HIREDATE, 2450 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1981-06-08 12:00:10', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7566 EMPNO, 'JONES'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-04-02', 'YYYY-MM-DD') HIREDATE, 2975 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1981-04-02 10:00:00', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7788 EMPNO, 'SCOTT'  ENAME, 'ANALYST'   JOB, 7566 MGR, TO_DATE('1987-04-19', 'YYYY-MM-DD') HIREDATE, 3000 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1981-12-01 15:10:01', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7369 EMPNO, 'SMITH'  ENAME, 'CLERK'     JOB, 7902 MGR, TO_DATE('1980-12-17', 'YYYY-MM-DD') HIREDATE, 800  SAL, NULL COMM, '20' DEPTCD, TO_DATE('1980-12-16 09:10:55', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7499 EMPNO, 'ALLEN'  ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-02-20', 'YYYY-MM-DD') HIREDATE, 1600 SAL, 300  COMM, '30' DEPTCD, TO_DATE('1981-02-19 10:20:30', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7521 EMPNO, 'WARD'   ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-02-22', 'YYYY-MM-DD') HIREDATE, 1250 SAL, 500  COMM, '30' DEPTCD, TO_DATE('1981-02-21 14:05:22', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7654 EMPNO, 'MARTIN' ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-09-28', 'YYYY-MM-DD') HIREDATE, 1250 SAL, 1400 COMM, '30' DEPTCD, TO_DATE('1981-09-27 11:05:02', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7844 EMPNO, 'TURNER' ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-09-08', 'YYYY-MM-DD') HIREDATE, 1500 SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-09-07 08:55:05', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7876 EMPNO, 'ADAMS'  ENAME, 'CLERK'     JOB, 7788 MGR, TO_DATE('1987-05-23', 'YYYY-MM-DD') HIREDATE, 1100 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1987-05-22 09:40:26', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7900 EMPNO, 'JAMES'  ENAME, 'CLERK'     JOB, 7698 MGR, TO_DATE('1981-12-03', 'YYYY-MM-DD') HIREDATE, 950  SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-12-02 13:30:02', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7934 EMPNO, 'MILLER' ENAME, 'CLERK'     JOB, 7782 MGR, TO_DATE('1982-01-23', 'YYYY-MM-DD') HIREDATE, 1300 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1982-01-22 16:38:15', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL
)
/*
SELECT job
     , SUM(sal) 
  FROM emp
 GROUP BY ROLLUP(job)--JOB 그룹화 데이터(2), 전체합계(1) 출력 -2레벨
;

SELECT job
     , DEPTCD
     , SUM(sal) 
  FROM emp
 GROUP BY ROLLUP(job, DEPTCD) --JOB, DEPTCD 별로 그룹화 데이터 내역(3), JOB별(소계)(2), 전체 합계(1)
;
*/
SELECT job
     , DEPTCD
     , SUM(sal) 
  FROM emp
 GROUP BY job, ROLLUP(DEPTCD) --JOB DEPTCD별 그룹화 데이터 내역(2), JOB별(소계) (1)
 ;

--------------------------------------ROLLUP 데이터 예제(20220523)

SELECT job
     , deptno
     , SUM(sal) 
  FROM emp
 GROUP BY ROLLUP(job, deptno)
HAVING GROUPING_ID(job, deptno) IN (0, 3) 
;

SELECT DECODE(GROUPING(job), 1, '?⑷퀎', job) AS job
     , deptno
     , SUM(sal) AS sal
  FROM emp
 GROUP BY ROLLUP(job, deptno)
HAVING GROUPING_ID(job, deptno) IN (0, 3)
;

--===============================================CUBE
WITH emp AS (
    SELECT 7839 EMPNO, 'KING'   ENAME, 'PRESIDENT' JOB, NULL MGR, TO_DATE('1981-11-17', 'YYYY-MM-DD') HIREDATE, 5000 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1981-11-16 09:00:05', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7698 EMPNO, 'BLAKE'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-05-01', 'YYYY-MM-DD') HIREDATE, 2850 SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-04-30 10:30:20', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7782 EMPNO, 'CLARK'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-06-09', 'YYYY-MM-DD') HIREDATE, 2450 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1981-06-08 12:00:10', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7566 EMPNO, 'JONES'  ENAME, 'MANAGER'   JOB, 7839 MGR, TO_DATE('1981-04-02', 'YYYY-MM-DD') HIREDATE, 2975 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1981-04-02 10:00:00', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7788 EMPNO, 'SCOTT'  ENAME, 'ANALYST'   JOB, 7566 MGR, TO_DATE('1987-04-19', 'YYYY-MM-DD') HIREDATE, 3000 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1981-12-01 15:10:01', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7369 EMPNO, 'SMITH'  ENAME, 'CLERK'     JOB, 7902 MGR, TO_DATE('1980-12-17', 'YYYY-MM-DD') HIREDATE, 800  SAL, NULL COMM, '20' DEPTCD, TO_DATE('1980-12-16 09:10:55', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7499 EMPNO, 'ALLEN'  ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-02-20', 'YYYY-MM-DD') HIREDATE, 1600 SAL, 300  COMM, '30' DEPTCD, TO_DATE('1981-02-19 10:20:30', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7521 EMPNO, 'WARD'   ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-02-22', 'YYYY-MM-DD') HIREDATE, 1250 SAL, 500  COMM, '30' DEPTCD, TO_DATE('1981-02-21 14:05:22', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7654 EMPNO, 'MARTIN' ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-09-28', 'YYYY-MM-DD') HIREDATE, 1250 SAL, 1400 COMM, '30' DEPTCD, TO_DATE('1981-09-27 11:05:02', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7844 EMPNO, 'TURNER' ENAME, 'SALESMAN'  JOB, 7698 MGR, TO_DATE('1981-09-08', 'YYYY-MM-DD') HIREDATE, 1500 SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-09-07 08:55:05', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7876 EMPNO, 'ADAMS'  ENAME, 'CLERK'     JOB, 7788 MGR, TO_DATE('1987-05-23', 'YYYY-MM-DD') HIREDATE, 1100 SAL, NULL COMM, '20' DEPTCD, TO_DATE('1987-05-22 09:40:26', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7900 EMPNO, 'JAMES'  ENAME, 'CLERK'     JOB, 7698 MGR, TO_DATE('1981-12-03', 'YYYY-MM-DD') HIREDATE, 950  SAL, NULL COMM, '30' DEPTCD, TO_DATE('1981-12-02 13:30:02', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL UNION ALL
    SELECT 7934 EMPNO, 'MILLER' ENAME, 'CLERK'     JOB, 7782 MGR, TO_DATE('1982-01-23', 'YYYY-MM-DD') HIREDATE, 1300 SAL, NULL COMM, '10' DEPTCD, TO_DATE('1982-01-22 16:38:15', 'YYYY-MM-DD HH24:MI:SS') EDITDATE FROM DUAL
)
/*
SELECT job
     , SUM(sal) 
  FROM emp
 GROUP BY CUBE(job)
;
--순서는 다르지만 같은 결과
SELECT job
     , SUM(sal) 
  FROM emp
 GROUP BY ROLLUP(job)
;
*/

/*
출력되는 유형 중 : 동일한 유형은 하나만 남김
GROUP BY ROLLUP(JOB, DEPTCD) : JOB + DEPTCD, JOB, 전체
GROUP BY ROLLUP(DEPTCD, JOB) : JOB + DEPTCD(중복으로 제외), DEPTCD, 전체(중복으로 제외)
    -> JOB + DEPTCD, JOB, DEPTCD, 전체
*/
SELECT job
     , DEPTCD
     , SUM(sal) 
  FROM emp
 GROUP BY CUBE(job, DEPTCD)
;

SELECT job
     , deptno
     , SUM(sal) 
  FROM emp
 GROUP BY CUBE(job, deptno)
HAVING GROUPING_ID(job, deptno) = 1
;

SELECT job
     , deptno
     , SUM(sal) 
  FROM emp
 GROUP BY CUBE(job, deptno)
HAVING GROUPING_ID(job, deptno) = 2
;